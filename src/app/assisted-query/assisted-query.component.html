<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<div class="jumbotron text-center">
	<h1 class="row justify-content-center">SmartQuery Engine</h1>


	<div class="container mt-5">
		<div class="row justify-content-center">

			<div class="col-12 col-md-10 col-lg-8">
				<form class="card card-sm" [formGroup]="formGroup"
					(ngSubmit)="onSubmitAssisted(formGroup.value); findImages(formGroup.value)" autocomplete="off">
					<!------------------------- Disable Autocomplete -------------------------->
					<input autocomplete="false" name="hidden" type="text" style="display:none;">
					<!------------------------------------------------------------------------->
					<div class="card-body row no-gutters align-items-center">
						<div class="col-auto">
							<i class="fas fa-search"></i>
						</div>
						<div class="col">
							<input class="form-control form-control-lg form-control-borderless" type="text" id="query"
								placeholder="Enter any statistcal query" formControlName="query" spellcheck="false">
						</div>
						<div class="col-auto">
							<button class="btn btn-lg btn-success" type="submit" (click)="activate = true; "
								style="background-color: #22a0e9;">Search</button>
							<!--<button class="btn btn-lg btn-success" type="submit" (click) = "findImages(formGroup.value); activate = true">Search</button> -->
						</div>
					</div>
				</form>
			</div>
		</div>
		<br>
	</div>
</div>

<!--
<div *ngIf="activate" class="container-lg m-5" style="background:#F9F9F9">
    <h3 class="text-left pt-3">Query Result:</h3>
	<p class="text-left pb-1">Tables related to your search:</p>
	<div class="container">
		<div class="row justify-content-center">
			<table class="styled-table" *ngIf="activate">
				<thead>
					<tr>
						<th>Query</th>
						<th>Result</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Percentage of patients who have more than 5 cavities</td>
						<td>15.6%</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>
-->
<div *ngIf="response_table[0]!='NONE' && response_table.length > 0 && activate" class="wide-container">
	<div class="card">
		<div class="card-body">
			<div class="d-flex justify-content-between">
				<h4 class="card-title">Relevant Categories</h4>
			</div>
			<div class="data_source" *ngFor=" let header of response_table[0]?.split(' ')">{{header.replace("|", "")}}
			</div>
		</div>
	</div>
</div>

<br>

<div *ngIf="response_table.length > 0" class="wide-container">
	<div class="card">
		<div class="card-body">
			<div class="d-flex justify-content-between">
				<h4 class="card-title">Associated Records</h4>
			</div>
			<div *ngIf="response_table[0]!='NONE'" class="alert alert-success alert-dismissible fade show" role="alert">
				<strong>Success</strong>, we found data that may be related to your search!
				<button type="button" class="close" data-dismiss="alert" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div *ngIf="response_table[0]=='NONE'" class="alert alert-danger alert-dismissible fade show" role="alert">
				<strong>Error</strong>, we found no data related to your query. Please try again!
				<button type="button" class="close" data-dismiss="alert" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<table *ngIf="response_table[0]!='NONE'" datatable [dtOptions]="dtOptions" class="row-border hover">
				<thead>
					<tr>
						<th *ngFor="let header of response_table[0]?.split('| ')">{{header}}</th>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let row of response_table | slice:1">
						<td *ngFor="let element of row.split('|', response_table[0]?.split('| ').length)">
							{{element}}
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>


<div *ngIf="images.length > 0" class="container-lg m-5" style="background:#F9F9F9">
	<h3 class="text-left pt-3">Associated Images</h3>
	<p class="text-left pb-1">Images we found associated to your search:</p>
	<div class="row">
		<div class="column">
			<div *ngFor="let image of images; index as i">
				<ng-container [ngSwitch]="true">
					<div *ngSwitchCase="(i+1)%3 === 0 && i > 0"></div>
					<div *ngSwitchCase="((i+1)%3)%2 === 0 && i > 0"></div>
					<div *ngSwitchDefault>
						<img [src]="getimageurl + images[i]" />
					</div>
				</ng-container>
			</div>
		</div>

		<div class="column">
			<div *ngFor="let image of images; index as i">
				<ng-container [ngSwitch]="true">
					<div *ngSwitchCase="(i+1)%3 === 0 && i > 0"></div>
					<div *ngSwitchCase="((i+1)%3)%2 === 0 && i > 0 && (i+1)%3>0">
						<img [src]="getimageurl + images[i]" />
					</div>
					<div *ngSwitchDefault></div>
				</ng-container>
			</div>
		</div>

		<div class="column">
			<div *ngFor="let image of images; index as i">
				<ng-container [ngSwitch]="true">
					<div *ngSwitchCase="(i+1)%3 === 0 && i > 0">
						<img [src]="getimageurl + images[i]" />
					</div>
					<div *ngSwitchCase="((i+1)%3)%2 === 0 && i > 0"></div>
					<div *ngSwitchDefault></div>
				</ng-container>
			</div>
		</div>

	</div>

</div>

<br>

<div *ngIf="response_table[0]!='NONE' && response_table.length > 0 && activate" class="jumbotron text-center">
	<h1 class="row justify-content-center">SmartQuery Engine</h1>


	<div class="container mt-5">
		<div class="row justify-content-center">

			<div class="col-12 col-md-10 col-lg-8">
				<form class="card card-sm" [formGroup]="formGroup2" (ngSubmit)="onSubmitAnalysis(formGroup2.value)"
					autocomplete="off">
					<!------------------------- Disable Autocomplete -------------------------->
					<input autocomplete="false" name="hidden" type="text" style="display:none;">
					<!------------------------------------------------------------------------->
					<div class="card-body row no-gutters align-items-center">
						<div class="col-auto">
							<i class="fas fa-chart-pie"></i>
						</div>
						<div class="col">
							<input class="form-control form-control-lg form-control-borderless" type="text" id="query2"
								placeholder="Enter any statistcal query" formControlName="query2" spellcheck="false">
						</div>
						<div class="col-auto">
							<button class="btn btn-lg btn-success" type="submit"
								(click)="visualization = true;">Visualize</button>
							<!--<button class="btn btn-lg btn-success" type="submit" (click) = "findImages(formGroup.value); activate = true">Search</button> -->
						</div>
					</div>
				</form>
			</div>
		</div>
		<br>
	</div>
</div>


<div *ngIf="showVisBox == true && response_table[0]!='NONE' && response_table.length > 0 && activate"
	class="small-container">
	<div class="card">
		<div class="card-body">
			<div class="d-flex justify-content-between">
				<h4 class="card-title text-center">Relevant Data Visualization</h4>
			</div>
			<div *ngIf="isThereAGraph" class="alert alert-success alert-dismissible fade show" role="alert">
				<strong>Success</strong>, we found data that may be related to your search!
				<button type="button" class="close" data-dismiss="alert" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div id="vis"></div>
		</div>
	</div>
</div>

<br>

<div *ngIf="showVisBox == true && response_table[0]!='NONE' && response_table.length > 0 && activate" class="container">
	<hr>
</div>